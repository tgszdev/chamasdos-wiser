<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîê Login - Chamados WMS</title>
    
    <!-- Meta tags -->
    <meta name="description" content="Acesso restrito ao sistema de chamados WMS">
    <meta name="robots" content="noindex, nofollow">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîê</text></svg>">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000000;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .video-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            object-fit: cover;
            object-position: center center;
            filter: blur(3px);
        }
        
        .video-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: -1;
        }
        
        .login-container {
            background: rgba(255, 255, 255, 0.97);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.1),
                0 1px 3px rgba(0, 0, 0, 0.08);
            max-width: 400px;
            width: 90%;
            overflow: hidden;
            border: 1px solid rgba(0, 0, 0, 0.08);
            animation: slideIn 0.6s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .login-header {
            background: rgba(255, 255, 255, 0.95);
            color: #202124;
            padding: 24px 32px;
            text-align: left;
            position: relative;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        }
        
        .login-header h1 {
            font-size: 20px;
            font-weight: 500;
            margin-bottom: 4px;
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .login-header p {
            color: #5f6368;
            font-size: 14px;
            position: relative;
            z-index: 1;
            margin: 0;
        }
        
        .login-form {
            padding: 40px 30px;
        }
        
        .form-group {
            margin-bottom: 16px;
            position: relative;
        }
        
        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 6px;
            color: #202124;
            font-size: 14px;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #dadce0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s ease;
            background: rgba(255, 255, 255, 0.95);
            color: #202124;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
            background: white;
        }
        
        .form-group input::placeholder {
            color: #9aa0a6;
        }
        

        
        .login-btn {
            width: 100%;
            padding: 12px 16px;
            background: #1a73e8;
            color: white;
            border: 1px solid #1a73e8;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .login-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .login-btn:hover::before { left: 100%; }
        
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(79, 70, 229, 0.4);
        }
        
        .login-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }
        
        .loading {
            position: relative;
        }
        
        .loading::after {
            content: '';
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: translateY(-50%) rotate(360deg); }
        }
        
        .error-message {
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
            color: #dc2626;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 20px;
            border: 1px solid #fecaca;
            display: none;
            animation: shake 0.5s ease-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .remember-me {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .remember-me input {
            margin-right: 10px;
            width: auto;
        }
        
        .remember-me label {
            margin-bottom: 0;
            font-size: 14px;
            color: #6b7280;
            cursor: pointer;
        }
        
        .login-footer {
            text-align: center;
            padding-bottom: 10px;
        }
        
        .login-footer p {
            color: #9ca3af;
            font-size: 12px;
        }
        
        .login-footer a {
            color: #4f46e5;
            text-decoration: none;
        }
        
        .login-footer a:hover {
            text-decoration: underline;
        }
        
        .security-info {
            background: rgba(59, 130, 246, 0.1);
            color: #1e40af;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            margin-top: 20px;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        .attempts-warning {
            background: linear-gradient(135deg, #fef3cd, #fde68a);
            color: #92400e;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 20px;
            border: 1px solid #f59e0b;
            display: none;
        }
        
        @media (max-width: 480px) {
            .login-container {
                margin: 20px;
                border-radius: 20px;
            }
            
            .login-header {
                padding: 30px 25px;
            }
            
            .login-form {
                padding: 30px 25px;
            }
            
            .login-header h1 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <!-- V√≠deo de fundo -->
    <video class="video-background" crossorigin="anonymous" playsinline preload="auto" muted loop autoplay>
        <source src="https://video.wixstatic.com/video/5d6ed6_f3549dd5db72460c90c6acef09667697/1080p/mp4/file.mp4" type="video/mp4">
    </video>
    <div class="video-overlay"></div>
    
    <div class="login-container">
        <div class="login-header">
            <h1>üîê Acesso Restrito</h1>
            <p>Sistema de Chamados WMS<br>Fa√ßa login para continuar</p>
        </div>
        
        <div class="login-form">
            <div id="attemptsWarning" class="attempts-warning">
                ‚ö†Ô∏è Muitas tentativas incorretas. Aguarde alguns segundos.
            </div>
            
            <div id="errorMessage" class="error-message">
                ‚ùå Usu√°rio ou senha incorretos. Tente novamente.
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">üë§ Usu√°rio:</label>
                    <input type="text" id="username" placeholder="Digite seu usu√°rio" required autocomplete="username">
                </div>
                
                <div class="form-group">
                    <label for="password">üîë Senha:</label>
                    <input type="password" id="password" placeholder="Digite sua senha" required autocomplete="current-password">
                </div>
                
                <div class="remember-me">
                    <input type="checkbox" id="rememberMe">
                    <label for="rememberMe">Lembrar-me neste dispositivo</label>
                </div>
                
                <button type="submit" class="login-btn" id="loginBtn">
                    üöÄ ENTRAR NO SISTEMA
                </button>
            </form>
            
            <div class="security-info">
                üîí <strong>Acesso Seguro:</strong> Suas credenciais s√£o verificadas localmente. Mantenha seus dados em sigilo.
            </div>
        </div>
        
        <div class="login-footer">
            <p>Sistema WMS v1.0</p>
        </div>
    </div>

    <script>
        // Sistema de usu√°rios unificado com admin.html
        let USERS = {};
        
        // Carregar usu√°rios do localStorage ou usar padr√£o
        function loadUsers() {
            const savedUsers = localStorage.getItem('wms_users');
            if (savedUsers) {
                USERS = JSON.parse(savedUsers);
            } else {
                // Usu√°rios padr√£o (mesmos do admin.html)
                USERS = {
                    'admin': {
                        password: 'wms2024',
                        name: 'Administrador',
                        role: 'admin',
                        email: 'admin@wms.com',
                        lastLogin: null,
                        createdAt: new Date().getTime()
                    },
                    'supervisor': {
                        password: 'sup123',
                        name: 'Supervisor',
                        role: 'supervisor',
                        email: 'supervisor@wms.com',
                        lastLogin: null,
                        createdAt: new Date().getTime()
                    },
                    'operador': {
                        password: 'op456',
                        name: 'Operador',
                        role: 'user',
                        email: 'operador@wms.com',
                        lastLogin: null,
                        createdAt: new Date().getTime()
                    }
                };
                saveUsers();
            }
        }
        
        // Salvar usu√°rios no localStorage
        function saveUsers() {
            localStorage.setItem('wms_users', JSON.stringify(USERS));
        }
        
        // Controle de tentativas
        let loginAttempts = 0;
        const MAX_ATTEMPTS = 3;
        let blockTime = 0;
        
        // Elementos DOM
        const loginForm = document.getElementById('loginForm');
        const loginBtn = document.getElementById('loginBtn');
        const errorMessage = document.getElementById('errorMessage');
        const attemptsWarning = document.getElementById('attemptsWarning');
        const passwordInput = document.getElementById('password');
        const usernameInput = document.getElementById('username');
        const rememberMe = document.getElementById('rememberMe');
        
        // Fun√ß√£o para criptografia simples (Base64 + Salt)
        function hashPassword(password, salt = 'wms-secure') {
            return btoa(salt + password + salt).replace(/=/g, '');
        }
        
        // Verificar se j√° est√° logado
        function checkExistingLogin() {
            const savedLogin = localStorage.getItem('wms_session');
            if (savedLogin) {
                try {
                    const session = JSON.parse(atob(savedLogin));
                    const now = new Date().getTime();
                    
                    // Verificar se a sess√£o ainda √© v√°lida (24 horas)
                    if (session.expires > now && session.user && USERS[session.user]) {
                        redirectToApp(session.user);
                        return true;
                    }
                } catch (e) {
                    localStorage.removeItem('wms_session');
                }
            }
            return false;
        }
        
        // Fun√ß√£o para fazer login
        function performLogin(username, password, remember = false) {
            // Verificar se usu√°rio existe e senha est√° correta
            if (USERS[username] && USERS[username].password === password) {
                // Login bem-sucedido
                const sessionData = {
                    user: username,
                    name: USERS[username].name,
                    role: USERS[username].role,
                    loginTime: new Date().getTime(),
                    expires: new Date().getTime() + (remember ? 7 * 24 * 60 * 60 * 1000 : 24 * 60 * 60 * 1000) // 7 dias se lembrar, 1 dia se n√£o
                };
                
                // Salvar sess√£o
                const encodedSession = btoa(JSON.stringify(sessionData));
                if (remember) {
                    localStorage.setItem('wms_session', encodedSession);
                } else {
                    sessionStorage.setItem('wms_session', encodedSession);
                }
                
                // Atualizar √∫ltimo login e salvar
                USERS[username].lastLogin = new Date().getTime();
                saveUsers();
                
                // Reset tentativas
                loginAttempts = 0;
                
                // Redirecionar
                redirectToApp(username);
                return true;
            }
            
            return false;
        }
        
        // Fun√ß√£o para redirecionar para o app
        function redirectToApp(username) {
            // Mostrar loading
            loginBtn.classList.add('loading');
            loginBtn.textContent = 'Entrando...';
            loginBtn.disabled = true;
            
            setTimeout(() => {
                // Redirecionar para a p√°gina principal
                window.location.href = '/';
            }, 1500);
        }
        
        // Fun√ß√£o para mostrar erro
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            
            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, 5000);
        }
        
        // Fun√ß√£o para verificar bloqueio por tentativas
        function checkBlocking() {
            if (blockTime > 0) {
                const remaining = Math.ceil((blockTime - new Date().getTime()) / 1000);
                if (remaining > 0) {
                    attemptsWarning.textContent = `‚ö†Ô∏è Aguarde ${remaining} segundos para tentar novamente.`;
                    attemptsWarning.style.display = 'block';
                    loginBtn.disabled = true;
                    return true;
                } else {
                    blockTime = 0;
                    loginAttempts = 0;
                    attemptsWarning.style.display = 'none';
                    loginBtn.disabled = false;
                    return false;
                }
            }
            return false;
        }
        

        
        // Evento de submit do formul√°rio
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Verificar se est√° bloqueado
            if (checkBlocking()) {
                return;
            }
            
            const username = usernameInput.value.trim().toLowerCase();
            const password = passwordInput.value;
            const remember = rememberMe.checked;
            
            if (!username || !password) {
                showError('‚ùå Por favor, preencha todos os campos.');
                return;
            }
            
            // Mostrar loading
            loginBtn.classList.add('loading');
            loginBtn.disabled = true;
            const originalText = loginBtn.textContent;
            loginBtn.textContent = 'Verificando...';
            
            // Simular delay de verifica√ß√£o (seguran√ßa)
            setTimeout(() => {
                if (performLogin(username, password, remember)) {
                    // Login bem-sucedido - redirecionamento j√° acontece em performLogin
                } else {
                    // Login falhou
                    loginAttempts++;
                    
                    if (loginAttempts >= MAX_ATTEMPTS) {
                        blockTime = new Date().getTime() + (30 * 1000); // 30 segundos
                        showError('‚ùå Muitas tentativas incorretas. Acesso bloqueado temporariamente.');
                        checkBlocking();
                    } else {
                        const remaining = MAX_ATTEMPTS - loginAttempts;
                        showError(`‚ùå Usu√°rio ou senha incorretos. ${remaining} tentativa(s) restante(s).`);
                    }
                    
                    // Reset form
                    passwordInput.value = '';
                    loginBtn.classList.remove('loading');
                    loginBtn.disabled = false;
                    loginBtn.textContent = originalText;
                    passwordInput.focus();
                }
            }, 1000);
        });
        

        
        // Verificar bloqueio a cada segundo
        setInterval(checkBlocking, 1000);
        
        // Verificar se j√° est√° logado ao carregar a p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            // IMPORTANTE: Carregar usu√°rios ANTES de verificar login
            loadUsers();
            
            // Log para desenvolvimento
            console.log('üîê Sistema de Login WMS carregado');
            console.log('üë• Usu√°rios dispon√≠veis:', Object.keys(USERS));
            
            if (!checkExistingLogin()) {
                // Focar no campo usu√°rio
                usernameInput.focus();
                
                // Carregar usu√°rio lembrado
                const rememberedUser = localStorage.getItem('wms_remembered_user');
                if (rememberedUser) {
                    usernameInput.value = rememberedUser;
                    passwordInput.focus();
                }
            }
        });
        
        // Salvar usu√°rio se "lembrar-me" estiver marcado
        usernameInput.addEventListener('change', function() {
            if (rememberMe.checked) {
                localStorage.setItem('wms_remembered_user', this.value);
            }
        });
        
        rememberMe.addEventListener('change', function() {
            if (this.checked && usernameInput.value) {
                localStorage.setItem('wms_remembered_user', usernameInput.value);
            } else {
                localStorage.removeItem('wms_remembered_user');
            }
        });
        
        // Atalho Enter
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !loginBtn.disabled) {
                loginForm.dispatchEvent(new Event('submit'));
            }
        });
        
        // Prevenir ataques b√°sicos
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('selectstart', e => e.preventDefault());
        
        // Log de tentativas (desenvolvimento) - movido para dentro da inicializa√ß√£o
    </script>
</body>
</html>